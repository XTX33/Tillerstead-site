{%- comment -%}
  Global and per-page scripts
  - contrast.js: high-visibility contrast system (WCAG AAA)
  - main.js: site-wide behaviors (nav, theme toggle, smooth scroll, forms)
  - page.scripts: optional array of additional script paths in front matter
  
  IMPORTANT: Each script should only be loaded ONCE.
  Duplicate script tags can cause infinite loops and crash Safari on iOS.
{%- endcomment -%}

<script
  defer
  src="{{ '/assets/js/contrast.js' | relative_url }}?v={{ site.version | default: site.github.build_revision | default: '10' }}">
</script>

<script
  defer
  src="{{ '/assets/js/main.js' | relative_url }}?v={{ site.version | default: site.github.build_revision | default: '10' }}">
</script>

{% if page.scripts %}
  {% for src in page.scripts %}
    <script
      defer
      src="{{ src | relative_url }}?v={{ site.version | default: site.github.build_revision | default: '10' }}">
    </script>
  {% endfor %}
{% endif %}

<!-- Tillerstead mobile nav script (namespaced, safe) -->
<script>
  (function(){
    const burger = document.getElementById('ts-burger') || document.getElementById('nav-toggle');
    const nav = document.getElementById('ts-main-nav') || document.getElementById('site-nav');
    if(!burger || !nav) return;
    burger.addEventListener('click', ()=> {
      const expanded = nav.getAttribute('aria-expanded') === 'true';
      nav.setAttribute('aria-expanded', String(!expanded));
      burger.setAttribute('aria-expanded', String(!expanded));
    });
  })();
</script>